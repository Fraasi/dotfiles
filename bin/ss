#!/usr/bin/env bash

user=$(id | cut -d ' ' -f 1)
# network node hostname | machine hardware name | kernel name
machine_names=$( uname -n; uname -m; uname -s; )
machine_names=${machine_names//[$'\n']/ }

uptime=$(awk '
BEGIN { FS = " " }
{
  D =  $1 / 86400
  H = ($1 / (60 * 60)) % 24
  M = ($1 / 60) % 60
  S = $1 % 60

  printf "Uptime: %dd - %dh:%dm:%ds\n", D, H, M, S
}
' /proc/uptime)

disk_free=$(
  df -h | awk 'BEGIN { print "Mount \t Used \t Avail" } /C|G/ { printf "%s \t %s \t %s\n", $NF, $(NF-1), $(NF-2)}'
)

function center_text {
     TERM_COLS="$(tput cols)"
     str_len="${#1}"
     filler_len="$(( (TERM_COLS - str_len) / 2 ))"
     [[ $# -ge 2 ]] && ch="${2:0:1}" || ch=" "
     filler=""
     for (( i = 0; i < filler_len; i++ )); do
          filler="${filler}${ch}"
     done

     printf "%s%s%s" "$filler" "$1" "$filler"
     [[ $(( (TERM_COLS - str_len) % 2 )) -ne 0 ]] && printf "%s" "${ch}"
     printf "\n"

     return 0
}

echo ''
center_text '' '='
center_text "s(tat)s"

echo "
$user @ $machine_names | $uptime

$disk_free
"

center_text '' '='
