#!/usr/bin/env python3

import sys
import re
import requests
import urllib
from bs4 import BeautifulSoup


url = 'https://movgotv.com' # /genre/featured/'

try:
  html = requests.get(url).text
except requests.exceptions.RequestException as err:
  raise SystemExit(err)
try:
  limit = int(sys.argv[1])
except:
  limit = 6

# for troubleshooting
# f = open('featured_test.html', 'w')
# f.write(html)
# f.close()

soup = BeautifulSoup(html, 'html.parser')

# movgotv
for div in soup.find_all('div', class_='ml-item'):
  if limit <= 0:
    break
  quality = div.find(class_='jtip-quality').get_text()
  if quality == 'CAM':
    continue

  title = div.find(class_='mli-info ntitl').get_text()
  year = div.find(class_="jt-info").findNext('a').get_text()
  rating = div.find(class_='jt-imdb').get_text()
  genres = ''
  for genre in div.findAll('a', attrs={"title": re.compile('Movies$')}):
    genres +=  ''.join(genre.findAll(text=True)) + ' '
  link = f"https://www.imdb.com/find?q={urllib.parse.quote_plus(title)}"
  parsed = '\n {0} ({1}) - {2}{3} - {4}\n {5}'.format(title, year, quality, rating, genres, link)
  print(parsed)
  limit -= 1
